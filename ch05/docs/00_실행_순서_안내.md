# WeTube 실행 순서 안내

실제 실행을 위한 단계별 가이드입니다.

---

## 1. 환경 준비

### 1-1. Python 확인
```powershell
python --version   # Python 3.10 이상 권장
```

### 1-2. 프로젝트 폴더 이동
```powershell
cd C:\Wetube\ch05
```

### 1-3. 가상환경 활성화 (선택)
```powershell
# 가상환경 사용 시
.\venv\Scripts\Activate.ps1
# 또는: venv\Scripts\activate
```

### 1-4. 의존성 설치
```powershell
pip install -r requirements.txt
```

---

## 2. 앱 실행

### 2-1. Flask 앱 설정 (최초 1회)
```powershell
$env:FLASK_APP="app"
$env:FLASK_DEBUG=1   # 코드 변경 시 자동 재시작 (선택)
```

### 2-2. 서버 실행
```powershell
flask run
```
또는
```powershell
python -m app
```

### 2-3. 브라우저 접속
```
http://127.0.0.1:5000
```

- 최초 실행 시 `instance/wetube.db` 및 기본 사용자(id=1)가 자동 생성됩니다.
- 5000 포트가 이미 사용 중이면 `Address already in use` 오류가 발생할 수 있습니다. 기존 프로세스를 종료한 뒤 다시 실행하세요.

---

## 3. 주요 기능 접근

| 순서 | 기능 | URL | 비고 |
|------|------|-----|------|
| 1 | 홈 (동영상 목록) | `/` | |
| 2 | 동영상 시청 | `/watch/<video_id>` | 조회수 증가, 구독 버튼 |
| 3 | 검색 | `/search?q=키워드` | |
| 4 | 태그별 영상 | `/tag/<tag_name>` | |
| 5 | Studio (업로드) | `/studio`, `/studio/upload` | 로그인 없이 접근 가능 |
| 6 | 사용자 프로필 | `/user/<username>` | 구독 버튼 |
| 7 | 구독 피드 | `/subscriptions` | |
| 8 | REST API | `/api/videos`, `/api/videos/<id>` 등 | JSON 응답 |
| 9 | 관리자 | `/admin` | |
| 10 | DB 검증 리포트 | `/admin/db-verify` | `scripts/db_verify.py` 실행 후 |

---

## 4. 테스트 실행

### 4-1. 전체 단위 테스트
```powershell
python -m pytest tests/ -v
```

### 4-2. API 테스트만
```powershell
python -m pytest tests/test_api.py -v
```

### 4-3. 파일 DB로 테스트 (검증용)
```powershell
$env:USE_TEST_DB_FILE=1; python -m pytest tests/test_api.py -v
# 이후 instance/test_pytest.db 확인
```

---

## 5. DB 검증 (전/후 비교)

> 상세 내용: `docs/19_DB_검증_및_전후비교.md` 참고

> **로그인·로그아웃 DB 검증**: `docs/21_로그인_로그아웃_DB_검증_안내.md` 참고 (users 테이블, 진행 순서)
> **회원정보 수정·비밀번호 변경 DB 검증**: `docs/22_회원정보수정_비밀번호변경_DB_검증_안내.md` 참고
> **댓글·대댓글 DB 검증**: `docs/23_댓글_대댓글_DB_검증_안내.md` 참고 (comments 테이블)

### 5-1. 검증 스크립트 실행 (가장 간단)
```powershell
cd C:\Wetube\ch05
python scripts/db_verify.py
```

- `instance/db_verify_report.html` 생성
- 브라우저에서 자동으로 리포트 열림

### 5-2. 앱에서 리포트 보기
1. `flask run` 으로 앱 실행
2. `python scripts/db_verify.py` 실행 (별도 터미널)
3. 브라우저에서 `http://127.0.0.1:5000/admin/db-verify` 접속

---

## 6. 한 번에 실행 (요약)

```powershell
# 1. 의존성 설치 (최초 1회)
pip install -r requirements.txt

# 2. 앱 실행
$env:FLASK_APP="app"; flask run

# 3. 브라우저
# http://127.0.0.1:5000
```

---

## 7. 문제 해결

| 증상 | 조치 |
|------|------|
| `ModuleNotFoundError` | `pip install -r requirements.txt` |
| `Address already in use` | 5000 포트 사용 중인 프로세스 종료 |
| `unable to open database file` | `instance` 폴더 존재 여부 확인, 관리자 권한 확인 |
| SQLAlchemy `TypingOnly` 오류 | `pip install "SQLAlchemy>=2.0.36" --upgrade` |
