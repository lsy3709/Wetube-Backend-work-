# 6.1 기능 구현 – 비디오 시청

유튜브처럼 비디오를 시청하는 기능을 구현한다. 라우트·DB 조회·조회수·플레이어·템플릿으로 구성한다.

---

## 6.1.1 라우트 설정

main 블루프린트에 `/watch/<int:video_id>` 경로를 정의한다.

- **경로**: `GET /watch/<int:video_id>`
- **역할**: 비디오 ID로 시청 페이지를 제공한다.
- **위치**: `app/routes/main.py`의 `watch(video_id)` 함수

---

## 6.1.2 데이터 불러오기

데이터베이스에서 `video_id`에 해당하는 비디오를 조회하고, 없으면 404를 반환한다.

- **방법**: `Video.query.get_or_404(video_id)` 사용
- **동작**: 레코드가 있으면 `Video` 객체 반환, 없으면 Flask가 404 페이지를 표시한다.

---

## 6.1.3 조회수 기능

페이지 방문 시마다 해당 비디오의 조회수를 1 증가시키고 DB에 반영한다.

- **코드**: `video.views += 1` 후 `db.session.commit()`
- **시점**: `get_or_404` 직후, 템플릿 렌더링 전에 실행
- **결과**: 시청 페이지를 열 때마다 `videos.views`가 1씩 증가한다.

---

## 6.1.4 화면 표시

`main/watch.html` 템플릿을 사용하고, 필요한 데이터를 전달한다.

- **템플릿**: `main/watch.html`
- **전달 변수**:
  - `video`: 시청 대상 비디오
  - `channel_name`: 채널(작성자) 이름
  - `related_videos`: 추천 동영상 목록 (최근 10개)

---

## 6.1.5 플레이어 제작

HTML5 `<video>` 태그로 비디오를 재생한다.

- **비디오 주소**: `video.get_video_url()` → `/media/videos/<filename>` 반환
- **썸네일(포스터)**: `poster` 속성에 `video.get_thumbnail_url()` 사용 (없으면 빈 문자열)
- **폴백**: `<source>` 아래에 "브라우저가 동영상을 재생할 수 없습니다." 문구

**예시 마크업**

```html
<video controls class="video-player-el" poster="{{ video.get_thumbnail_url() or '' }}">
  <source src="{{ video.get_video_url() }}" type="video/mp4">
  브라우저가 동영상을 재생할 수 없습니다.
</video>
```

---

## 6.1.6 Video 모델 헬퍼 메서드

템플릿에서 사용하는 URL 메서드를 Video 모델에 추가한다.

| 메서드 | 역할 | 반환 |
|--------|------|------|
| `get_video_url()` | 비디오 재생 URL | `url_for('main.media_video', filename=video_path)` |
| `get_thumbnail_url()` | 썸네일 이미지 URL | `url_for('main.media_thumbnail', filename=thumbnail_path)` 또는 `None` |

- **위치**: `app/models/video.py`
- **의존**: `main.media_video`, `main.media_thumbnail` 라우트 (업로드 파일 서빙)

---

## 구현 파일 요약

| 구분 | 파일 | 내용 |
|------|------|------|
| 라우트 | `app/routes/main.py` | `watch(video_id)`: get_or_404, 조회수 증가, 템플릿 렌더 |
| 모델 | `app/models/video.py` | `get_video_url()`, `get_thumbnail_url()` |
| 템플릿 | `app/templates/main/watch.html` | HTML5 `<video>`, poster, source |
