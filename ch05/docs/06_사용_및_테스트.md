# 06. 사용 및 테스트

## 사용 방법

1. 앱 실행 (예: `flask run` 또는 `python -m app`). (ch05 폴더에서 `set FLASK_APP=app` 후 `flask run`)
2. 브라우저에서 **http://127.0.0.1:5000** 접속.
3. **Studio**: 로그인 없이 접근 가능. 헤더의 "Studio" 버튼 또는 사이드바 "Studio" 링크로 `/studio` 이동.
4. `/studio` 또는 `/studio/upload` 접속.
5. 제목 입력, 비디오 파일 선택, 설명·썸네일(선택) 입력 후 "업로드" 클릭.
6. 성공 시 Studio 인덱스(`/studio/`)로 리다이렉트되고 "동영상이 업로드되었습니다." 메시지 표시.
7. 실패 시 같은 폼에 에러 메시지가 표시되고, 제목·설명은 유지된다.

## 허용 비디오 형식

- **확장자**: mp4, webm, mov (config에서 변경 가능)
- **최대 크기**: 2GB (config `MAX_VIDEO_SIZE`)

## 허용 썸네일 형식

- **확장자**: jpg, jpeg, png, gif, webp
- **최대 크기**: 5MB (`MAX_THUMBNAIL_SIZE`)

## 에러 케이스 확인 예시

| 확인 항목            | 방법                                                                                                             |
| -------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 제목 없이 제출       | 제목 비우고 업로드 → "제목을 입력해주세요."                                                                      |
| 비디오 없이 제출     | 파일 선택 안 하고 제출 → 클라이언트에서 "동영상 파일을 선택해주세요." (또는 서버에서 파일 없음 에러)             |
| 비디오 확장자 불일치 | .avi, .mkv 등 허용 목록 외 파일 선택 후 제출 → "허용되지 않는 파일 형식입니다. 허용: ..."                        |
| 비디오 용량 초과     | 2GB 초과 파일 제출 → "파일 크기가 너무 큽니다. ..."                                                              |
| 썸네일만 잘못된 경우 | 비디오는 유효, 썸네일만 허용 외 확장자/용량 초과 → 썸네일 에러 메시지, 이미 저장된 비디오 파일은 삭제 후 폼 복귀 |

## 저장 경로

- **비디오**: `{프로젝트 루트}/uploads/videos/{uuid}.{ext}`
- **썸네일**: `{프로젝트 루트}/uploads/thumbnails/{uuid}.{ext}`
- **DB**: `{프로젝트 루트}/instance/wetube.db` (기본값)

## 문제 해결

- **Python 3.13 + SQLAlchemy 오류**: `AssertionError: ... TypingOnly ... __static_attributes__` 가 나오면 SQLAlchemy가 3.13과 비호환인 구버전일 수 있음. `requirements.txt`에서 SQLAlchemy를 `>=2.0.36`으로 두고 `pip install -r requirements.txt --upgrade` 후 다시 `flask run` 하면 된다.

## 참고 사항

- **user_id**: 로그인 미연동이므로 `config.DEFAULT_USER_ID`(기본 1) 사용. 로그인 연동 시 `current_user.id` 등으로 교체하면 된다.
- **visibility**: 폼에만 있고 현재 업로드 처리·Video 모델에는 반영되지 않음. 필요 시 모델·라우트에 필드 추가 후 저장하면 된다.
- **공개 설정**: "해당 기능만 구현" 범위에 포함하지 않았으므로, 문서화·테스트는 업로드·검증·저장 흐름 위주로 한다.
