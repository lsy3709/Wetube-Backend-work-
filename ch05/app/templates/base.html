<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>{% block title %}WeTube{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
</head>
<body class="{% if current_user.is_authenticated %}is-logged-in{% endif %}{% if current_user.is_authenticated and current_user.is_admin %} is-admin{% endif %}">
  <header class="header {% block header_class %}header--with-sidebar{% endblock %}" id="main-header">
    <a href="{{ url_for('main.index') }}" class="logo">WeTube</a>
    <form class="search-wrap" method="get" action="{{ url_for('main.search') }}">
      <input type="search" name="q" class="search-input" placeholder="ê²€ìƒ‰" aria-label="ê²€ìƒ‰" value="{{ request.args.get('q', '') }}">
      <button type="submit" class="search-btn" aria-label="ê²€ìƒ‰">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
      </button>
    </form>
    <div class="header-actions">
      <div data-logged-out-only>
        <a href="{{ url_for('studio.index') }}" class="btn btn--outline">Studio</a>
        <a href="{{ url_for('auth.login') }}" class="btn btn--outline">ë¡œê·¸ì¸</a>
        <a href="{{ url_for('auth.register') }}" class="btn btn--primary">íšŒì›ê°€ì…</a>
      </div>
      <div data-logged-in-only>
        <a href="{{ url_for('studio.index') }}" class="btn btn--icon" title="Studio">ğŸ¬</a>
        <a href="{{ url_for('admin.index') }}" class="btn btn--icon" data-admin-only title="ê´€ë¦¬ì" style="{% if not (current_user.is_authenticated and current_user.is_admin) %}display: none;{% endif %}">ğŸ›¡ï¸</a>
        <button type="button" class="btn btn--icon" title="ì•Œë¦¼">ğŸ””</button>
        <span class="header-email" title="{{ current_user.email }}">{{ current_user.email }}</span>
        <a href="{{ url_for('auth.logout') }}" class="btn btn--outline btn--small header-logout-btn" title="ë¡œê·¸ì•„ì›ƒ">ë¡œê·¸ì•„ì›ƒ</a>
        <a href="{{ url_for('auth.profile') }}" class="avatar" id="btn-avatar" title="ë§ˆì´í˜ì´ì§€">
          {% if current_user.is_authenticated and current_user.profile_image %}
          <img src="{{ url_for('main.media_profile', filename=current_user.profile_image) }}" alt="" class="avatar-img">
          {% else %}
          <span id="header-username">{{ (current_user.username or '')[0:1]|upper }}</span>
          {% endif %}
        </a>
      </div>
    </div>
  </header>

  <aside class="sidebar">
    <nav>
      <ul class="sidebar-nav">
        <li><a href="{{ url_for('main.index') }}"><span class="icon">ğŸ </span> í™ˆ</a></li>
        <li><a href="#"><span class="icon">â–¶</span> Shorts</a></li>
        <li><a href="{{ url_for('main.subscriptions') }}"><span class="icon">ğŸ“º</span> êµ¬ë…</a></li>
        <li><a href="#"><span class="icon">ğŸ“š</span> ë³´ê´€í•¨</a></li>
        <li><a href="#"><span class="icon">ğŸ•</span> ì‹œì²­ ê¸°ë¡</a></li>
        <li class="sidebar-divider"></li>
        {% set _cat = request.args.get('category') or 'all' %}
        <li><a href="{{ url_for('main.index', category='all') }}" class="sidebar-category {% if _cat == 'all' %}active{% endif %}">ì „ì²´</a></li>
        <li><a href="{{ url_for('main.index', category='entertainment') }}" class="sidebar-category {% if _cat == 'entertainment' %}active{% endif %}">ì—”í„°í…Œì¸ë¨¼íŠ¸</a></li>
        <li><a href="{{ url_for('main.index', category='music') }}" class="sidebar-category {% if _cat == 'music' %}active{% endif %}">ìŒì•…</a></li>
        <li><a href="{{ url_for('main.index', category='sports') }}" class="sidebar-category {% if _cat == 'sports' %}active{% endif %}">ìŠ¤í¬ì¸ </a></li>
        <li><a href="{{ url_for('main.index', category='game') }}" class="sidebar-category {% if _cat == 'game' %}active{% endif %}">ê²Œì„</a></li>
        <li><a href="{{ url_for('main.index', category='education') }}" class="sidebar-category {% if _cat == 'education' %}active{% endif %}">êµìœ¡</a></li>
        <li><a href="{{ url_for('main.index', category='tech') }}" class="sidebar-category {% if _cat == 'tech' %}active{% endif %}">ê¸°ìˆ </a></li>
        <li><a href="{{ url_for('main.index', category='comedy') }}" class="sidebar-category {% if _cat == 'comedy' %}active{% endif %}">ì½”ë¯¸ë””</a></li>
        <li><a href="{{ url_for('main.index', category='travel') }}" class="sidebar-category {% if _cat == 'travel' %}active{% endif %}">ì—¬í–‰</a></li>
        <li><a href="{{ url_for('main.index', category='food') }}" class="sidebar-category {% if _cat == 'food' %}active{% endif %}">ìŒì‹</a></li>
        <li><a href="{{ url_for('main.index', category='lifestyle') }}" class="sidebar-category {% if _cat == 'lifestyle' %}active{% endif %}">ë¼ì´í”„ìŠ¤íƒ€ì¼</a></li>
        <li><a href="{{ url_for('main.index', category='news') }}" class="sidebar-category {% if _cat == 'news' %}active{% endif %}">ë‰´ìŠ¤</a></li>
        <li><a href="{{ url_for('main.index', category='etc') }}" class="sidebar-category {% if _cat == 'etc' %}active{% endif %}">ê¸°íƒ€</a></li>
        <li class="sidebar-divider"></li>
        <li><a href="{{ url_for('studio.index') }}"><span class="icon">ğŸ¬</span> Studio</a></li>
        <li><a href="{{ url_for('main.user_profile', username=current_user.username if current_user.is_authenticated else 'default') }}"><span class="icon">â–¶</span> ë‚´ ë™ì˜ìƒ</a></li>
        <li><a href="#"><span class="icon">â±</span> ë‚˜ì¤‘ì— ë³¼ ë™ì˜ìƒ</a></li>
        <li><a href="{{ url_for('auth.profile') }}"><span class="icon">ğŸ‘¤</span> ë§ˆì´í˜ì´ì§€</a></li>
      </ul>
    </nav>
  </aside>

  <main class="main-wrap main-wrap--with-sidebar">
    <div class="main-content">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-wrap" role="region" aria-label="ì•Œë¦¼">
            {% for category, msg in messages %}
              <div class="auth-msg auth-msg--{{ category or 'success' }} is-visible" role="alert">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ í† ê¸€ (ì˜¤ë¥¸ìª½ í•˜ë‹¨) -->
  <button type="button" class="theme-toggle" id="theme-toggle" aria-label="í…Œë§ˆ ì „í™˜" title="ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ">
    <span class="theme-icon theme-icon--sun" title="ë¼ì´íŠ¸ ëª¨ë“œ">â˜€ï¸</span>
    <span class="theme-icon theme-icon--moon" title="ë‹¤í¬ ëª¨ë“œ">ğŸŒ™</span>
  </button>

  <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
