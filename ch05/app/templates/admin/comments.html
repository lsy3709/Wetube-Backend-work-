{% extends "base.html" %}

{% block title %}ëŒ“ê¸€ ê´€ë¦¬ - ê´€ë¦¬ì - WeTube{% endblock %}

{% block content %}
  <div class="admin-page admin-comments-page">
    <div class="admin-header">
      <div class="admin-header-left">
        <a href="{{ url_for('admin.index') }}" class="admin-back-link">â† ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</a>
        <h1 class="admin-title">ëŒ“ê¸€ ê´€ë¦¬</h1>
      </div>
      <div class="admin-header-actions">
        <a href="{{ url_for('auth.logout') }}" class="btn btn--outline">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>

    <div class="admin-content">
      <!-- ê²€ìƒ‰ -->
      <div class="admin-toolbar">
        <form method="get" action="{{ url_for('admin.comments') }}" class="admin-search-form">
          <input type="search" name="q" id="comment-search" class="admin-search-input" placeholder="ëŒ“ê¸€ ë‚´ìš©, ì‘ì„±ì ê²€ìƒ‰" value="{{ request.args.get('q', '') }}">
          <button type="submit" class="btn btn--primary" id="btn-search">ê²€ìƒ‰</button>
        </form>
      </div>

      <!-- ëŒ“ê¸€ ëª©ë¡ í…Œì´ë¸” (DB ì—°ë™) -->
      <div class="admin-table-wrap">
        <table class="admin-table admin-table--comments">
          <thead>
            <tr>
              <th class="col-num">#</th>
              <th class="col-video">ë™ì˜ìƒ</th>
              <th class="col-author">ì‘ì„±ì</th>
              <th class="col-content">ëŒ“ê¸€ ë‚´ìš©</th>
              <th class="col-date">ì‘ì„±ì¼</th>
              <th class="col-parent">ë‹µê¸€</th>
              <th class="col-actions">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody>
            {% for c in comments.items or [] %}
            <tr>
              <td class="col-num">{{ c.id }}</td>
              <td class="col-video">
                <a href="{{ url_for('main.watch', video_id=c.video_id) }}" class="video-link">{{ c.video.title if c.video else '(ì‚­ì œë¨)' }}</a>
              </td>
              <td class="col-author">{{ c.user.username if c.user else '(ì•Œ ìˆ˜ ì—†ìŒ)' }}</td>
              <td class="col-content">
                <span class="comment-text-preview">{{ c.content[:80] }}{% if c.content|length > 80 %}...{% endif %}</span>
              </td>
              <td class="col-date">{{ c.created_at.strftime('%Y.%m.%d %H:%M') if c.created_at else '' }}</td>
              <td class="col-parent">{{ 'ëŒ€ëŒ“ê¸€' if c.parent_id else '-' }}</td>
              <td class="col-actions">
                <form method="post" action="{{ url_for('admin.comment_delete', comment_id=c.id) }}" class="admin-delete-form" style="display: inline;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="page" value="{{ comments.page }}">
                  <input type="hidden" name="q" value="{{ request.args.get('q', '') }}">
                  <button type="submit" class="btn-icon btn-icon--danger" title="ì‚­ì œ" onclick="return confirm('ì´ ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?');">ğŸ—‘ï¸</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="7" class="admin-empty">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      {% if comments.pages > 1 %}
      <div class="admin-pagination">
        {% if comments.has_prev %}
        <a href="{{ url_for('admin.comments', page=comments.prev_num, q=request.args.get('q', '')) }}" class="btn btn--outline btn--small">ì´ì „</a>
        {% else %}
        <button type="button" class="btn btn--outline btn--small" disabled>ì´ì „</button>
        {% endif %}
        <span class="pagination-info">{{ comments.page }} / {{ comments.pages }} í˜ì´ì§€</span>
        {% if comments.has_next %}
        <a href="{{ url_for('admin.comments', page=comments.next_num, q=request.args.get('q', '')) }}" class="btn btn--outline btn--small">ë‹¤ìŒ</a>
        {% else %}
        <button type="button" class="btn btn--outline btn--small" disabled>ë‹¤ìŒ</button>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/admin-comments-page.js') }}"></script>
{% endblock %}
