{% extends "base.html" %}

{% block title %}{{ video.title }} - WeTube{% endblock %}

{% block content %}
  <div class="watch-page" data-logged-in-only>
    <div class="watch-content">
      <!-- ë©”ì¸ ë¹„ë””ì˜¤ ì˜ì—­ -->
      <div class="watch-main">
        <!-- ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ -->
        <div class="video-player">
          <video controls class="video-player-el" poster="{% if video.thumbnail_path %}{{ url_for('main.media_thumbnail', filename=video.thumbnail_path) }}{% endif %}">
            <source src="{{ url_for('main.media_video', filename=video.video_path) }}" type="video/mp4">
            ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒì„ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
          </video>
        </div>

        <!-- ë¹„ë””ì˜¤ ì •ë³´ -->
        <div class="video-info">
          <h1 class="video-title">{{ video.title }}</h1>
          <div class="video-stats">
            <span class="video-views">ì¡°íšŒìˆ˜ {{ video.views }}íšŒ</span>
            <span class="video-date">{{ video.created_at.strftime('%Y. %m. %d.') if video.created_at else '' }}</span>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="video-actions">
            <div class="video-actions-left">
              <button type="button" class="action-btn" id="btn-like" title="ì¢‹ì•„ìš”">
                <span class="action-icon">ğŸ‘</span>
                <span class="action-count">0</span>
              </button>
              <button type="button" class="action-btn" id="btn-dislike" title="ì‹«ì–´ìš”">
                <span class="action-icon">ğŸ‘</span>
                <span class="action-count">0</span>
              </button>
              <button type="button" class="action-btn" id="btn-share" title="ê³µìœ ">
                <span class="action-icon">ğŸ“¤</span>
                <span class="action-text">ê³µìœ </span>
              </button>
              <button type="button" class="action-btn" id="btn-save" title="ì €ì¥">
                <span class="action-icon">ğŸ“¥</span>
                <span class="action-text">ì €ì¥</span>
              </button>
            </div>
            <div class="video-actions-right">
              <button type="button" class="action-btn" id="btn-more" title="ë”ë³´ê¸°">
                <span class="action-icon">â‹¯</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ì±„ë„ ì •ë³´ -->
        <div class="channel-info">
          <a href="{{ url_for('main.user_profile', username=channel_name) }}" class="channel-avatar">
            <span>{{ (channel_name or 'D')[0]|upper }}</span>
          </a>
          <div class="channel-details">
            <a href="{{ url_for('main.user_profile', username=channel_name) }}" class="channel-name">{{ channel_name }}</a>
            <div class="channel-subs">êµ¬ë…ì 0ëª…</div>
          </div>
          <button type="button" class="btn btn--primary" id="btn-subscribe">êµ¬ë…</button>
        </div>

        <!-- íƒœê·¸ (DB ì—°ë™) -->
        {% if video.tags %}
        <div class="video-tags">
          {% for t in video.tags %}
          <a href="{{ url_for('main.tag', tag_name=t.name) }}" class="tag-pill tag-pill--small">#{{ t.name }}</a>
          {% endfor %}
        </div>
        {% endif %}

        <!-- ì„¤ëª… -->
        <div class="video-description">
          <div class="description-content" id="description-content">
            {% if video.description %}
            <p>{{ video.description }}</p>
            {% else %}
            <p>ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
          </div>
          <button type="button" class="description-toggle" id="description-toggle">ë”ë³´ê¸°</button>
        </div>

        <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
        <div class="comments-section">
          <div class="comments-header">
            <h2 class="comments-title">ëŒ“ê¸€ <span id="comments-count">3</span>ê°œ</h2>
            <div class="comments-sort">
              <button type="button" class="sort-btn active">ì¸ê¸°ìˆœ</button>
              <button type="button" class="sort-btn">ìµœì‹ ìˆœ</button>
            </div>
          </div>

          <!-- ëŒ“ê¸€ ì‘ì„± -->
          <div class="comment-form">
            <div class="comment-avatar">
              <span>A</span>
            </div>
            <div class="comment-input-wrap">
              <input type="text" id="comment-input" class="comment-input" placeholder="ëŒ“ê¸€ ì¶”ê°€...">
              <div class="comment-actions" id="comment-actions" style="display: none;">
                <button type="button" class="btn btn--outline" id="comment-cancel">ì·¨ì†Œ</button>
                <button type="button" class="btn btn--primary" id="comment-submit">ëŒ“ê¸€</button>
              </div>
            </div>
          </div>

          <!-- ëŒ“ê¸€ ëª©ë¡ -->
          <div class="comments-list" id="comments-list">
            <div class="comment-item">
              <div class="comment-avatar"><span>U</span></div>
              <div class="comment-body">
                <div class="comment-header">
                  <span class="comment-author">ì‚¬ìš©ì1</span>
                  <span class="comment-time">1ì¼ ì „</span>
                </div>
                <p class="comment-text">ì¢‹ì€ ì˜ìƒì´ë„¤ìš”!</p>
                <div class="comment-footer">
                  <button type="button" class="comment-action">ğŸ‘ 5</button>
                  <button type="button" class="comment-action">ğŸ‘</button>
                  <button type="button" class="comment-action">ë‹µê¸€</button>
                </div>
              </div>
            </div>

            <div class="comment-item">
              <div class="comment-avatar"><span>G</span></div>
              <div class="comment-body">
                <div class="comment-header">
                  <span class="comment-author">ê²ŒìŠ¤íŠ¸</span>
                  <span class="comment-time">2ì¼ ì „</span>
                </div>
                <p class="comment-text">ì˜ ë´¤ìŠµë‹ˆë‹¤. êµ¬ë…í–ˆì–´ìš”!</p>
                <div class="comment-footer">
                  <button type="button" class="comment-action">ğŸ‘ 2</button>
                  <button type="button" class="comment-action">ğŸ‘</button>
                  <button type="button" class="comment-action">ë‹µê¸€</button>
                </div>
              </div>
            </div>

            <div class="comment-item">
              <div class="comment-avatar"><span>T</span></div>
              <div class="comment-body">
                <div class="comment-header">
                  <span class="comment-author">í…ŒìŠ¤í„°</span>
                  <span class="comment-time">3ì¼ ì „</span>
                </div>
                <p class="comment-text">í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ëŒ“ê¸€ì…ë‹ˆë‹¤.</p>
                <div class="comment-footer">
                  <button type="button" class="comment-action">ğŸ‘ 1</button>
                  <button type="button" class="comment-action">ğŸ‘</button>
                  <button type="button" class="comment-action">ë‹µê¸€</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì¶”ì²œ ë™ì˜ìƒ ì‚¬ì´ë“œë°” (DB ì—°ë™) -->
      <aside class="watch-sidebar">
        <h3 class="sidebar-title">ì¶”ì²œ ë™ì˜ìƒ</h3>
        <div class="related-videos">
          {% for v in related_videos or [] %}
          <a href="{{ url_for('main.watch', video_id=v.id) }}" class="related-video-card">
            <div class="related-video-thumb">
              {% if v.thumbnail_path %}
              <img src="{{ url_for('main.media_thumbnail', filename=v.thumbnail_path) }}" alt="" class="related-video-thumb-img">
              {% else %}
              <span>ğŸ“¹</span>
              {% endif %}
            </div>
            <div class="related-video-info">
              <h4 class="related-video-title">{{ v.title }}</h4>
              <a href="{{ url_for('main.user_profile', username='default') }}" class="related-video-channel" onclick="event.stopPropagation();">default</a>
              <p class="related-video-meta">ì¡°íšŒìˆ˜ {{ v.views }}íšŒ</p>
            </div>
          </a>
          {% else %}
          <p class="related-empty">ì¶”ì²œ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
          {% endfor %}
        </div>
      </aside>
    </div>
  </div>

  <div class="watch-logged-out" data-logged-out-only>
    <div class="hero">
      <h1>ë™ì˜ìƒì„ ì‹œì²­í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h1>
      <p>ë¡œê·¸ì¸í•˜ì—¬ ë™ì˜ìƒì„ ê°ìƒí•˜ê³  ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”.</p>
      <a href="{{ url_for('auth.login') }}" class="btn btn--primary">ë¡œê·¸ì¸</a>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/watch-page.js') }}"></script>
{% endblock %}
