{% extends "base.html" %}

{% block title %}{{ user.nickname or user.username }} - WeTube{% endblock %}

{% block content %}
  <div class="user-profile-page">
    <!-- ì±„ë„ í—¤ë” -->
    <div class="user-profile-header">
      <div class="user-profile-avatar">
        {% if user.profile_image %}
        <img src="{{ url_for('main.media_profile', filename=user.profile_image) }}" alt="{{ user.nickname or user.username }}">
        {% else %}
        <span>{{ (user.nickname or user.username)[0]|upper }}</span>
        {% endif %}
      </div>
      <div class="user-profile-info">
        <h1 class="user-profile-name">{{ user.nickname or user.username }}</h1>
        <p class="user-profile-handle">@{{ user.username }}</p>
        <p class="user-profile-subs">
          êµ¬ë…ì {{ stats.subscriber_count }}ëª… Â· ë™ì˜ìƒ {{ stats.video_count }}ê°œ Â·
          ì´ ì¡°íšŒìˆ˜ {{ stats.total_views }}íšŒ Â· ì´ ì¢‹ì•„ìš” {{ stats.total_likes }}
        </p>
        <p class="user-profile-desc">ì±„ë„ ì„¤ëª…</p>
        <button type="button" class="btn {% if is_subscribed %}btn--outline subscribed{% else %}btn--primary{% endif %}" id="btn-subscribe" data-channel-username="{{ user.username }}">{{ 'êµ¬ë…ì¤‘' if is_subscribed else 'êµ¬ë…' }}</button>
      </div>
    </div>

    <!-- íƒ­ -->
    <div class="user-profile-tabs">
      <button type="button" class="profile-tab active" data-tab="videos">ë™ì˜ìƒ</button>
      <button type="button" class="profile-tab" data-tab="playlists">ì¬ìƒëª©ë¡</button>
      <button type="button" class="profile-tab" data-tab="about">ì •ë³´</button>
    </div>

    <!-- ë™ì˜ìƒ ëª©ë¡ (DB ì—°ë™, í˜ì´ì§€ë„¤ì´ì…˜) -->
    <div class="user-profile-content" id="tab-videos">
      <div class="user-video-grid">
        {% for video in videos.items %}
        <a href="{{ url_for('main.watch', video_id=video.id) }}" class="video-card">
          <div class="video-card-thumb">
            {% if video.thumbnail_path %}
            <img src="{{ url_for('main.media_thumbnail', filename=video.thumbnail_path) }}" alt="" class="video-card-thumb-img">
            {% else %}
            <span>ğŸ“¹</span>
            {% endif %}
          </div>
          <h3 class="video-card-title">{{ video.title }}</h3>
          <p class="video-card-meta">ì¡°íšŒìˆ˜ {{ video.views }}íšŒ Â· ì¢‹ì•„ìš” {{ video.likes|default(0) }} Â· {{ video.created_at.strftime('%Y-%m-%d') if video.created_at else '' }}</p>
        </a>
        {% else %}
        <p class="empty-text">ì—…ë¡œë“œí•œ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      {% if videos.pages > 1 %}
      <nav class="pagination" aria-label="í”„ë¡œí•„ ë™ì˜ìƒ í˜ì´ì§€">
        <div class="pagination-inner">
          {% if videos.has_prev %}
          <a href="{{ url_for('main.user_profile', username=user.username, page=videos.prev_num) }}" class="pagination-link">ì´ì „</a>
          {% endif %}
          <span class="pagination-info">{{ videos.page }} / {{ videos.pages }}</span>
          {% if videos.has_next %}
          <a href="{{ url_for('main.user_profile', username=user.username, page=videos.next_num) }}" class="pagination-link">ë‹¤ìŒ</a>
          {% endif %}
        </div>
      </nav>
      {% endif %}
    </div>

    <!-- ì¬ìƒëª©ë¡ (ìˆ¨ê¹€) -->
    <div class="user-profile-content" id="tab-playlists" style="display: none;">
      <div class="empty-state">
        <p class="empty-text">ì¬ìƒëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </div>

    <!-- ì •ë³´ (ìˆ¨ê¹€) -->
    <div class="user-profile-content" id="tab-about" style="display: none;">
      <div class="user-about">
        <h3>ì±„ë„ ì„¤ëª…</h3>
        <p>ì±„ë„ ì„¤ëª…</p>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/user-profile-page.js') }}"></script>
{% endblock %}
