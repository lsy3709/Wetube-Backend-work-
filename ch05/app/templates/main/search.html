{% extends "base.html" %}

{% block title %}ê²€ìƒ‰: {{ q or '' }} - WeTube{% endblock %}

{% block content %}
  <div class="search-page">
    <!-- ê²€ìƒ‰ í¼ (ì…ë ¥ê°’ ìœ ì§€) -->
    <form class="search-form" method="get" action="{{ url_for('main.search') }}">
      <input type="search" name="q" class="search-input" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" value="{{ q or '' }}" aria-label="ê²€ìƒ‰ì–´">
      <input type="hidden" name="category" value="{{ category or '' }}">
      <input type="hidden" name="sort" value="{{ sort or 'latest' }}">
      <button type="submit" class="btn btn--primary">ê²€ìƒ‰</button>
    </form>

    <!-- ê²€ìƒ‰ì–´ ìˆì„ ë•Œë§Œ í•„í„°Â·ê²°ê³¼ í‘œì‹œ -->
    {% if q %}
    <div class="search-filters">
      <form method="get" action="{{ url_for('main.search') }}" id="search-filter-form">
        <input type="hidden" name="q" value="{{ q }}">
        <div class="filter-row">
          <label class="filter-label">ì¹´í…Œê³ ë¦¬</label>
          <select name="category" class="filter-select" onchange="this.form.submit()">
            <option value="" {% if not category %}selected{% endif %}>ì „ì²´</option>
            <option value="entertainment" {% if category == 'entertainment' %}selected{% endif %}>ì—”í„°í…Œì¸ë¨¼íŠ¸</option>
            <option value="music" {% if category == 'music' %}selected{% endif %}>ìŒì•…</option>
            <option value="sports" {% if category == 'sports' %}selected{% endif %}>ìŠ¤í¬ì¸ </option>
            <option value="game" {% if category == 'game' %}selected{% endif %}>ê²Œì„</option>
            <option value="education" {% if category == 'education' %}selected{% endif %}>êµìœ¡</option>
            <option value="tech" {% if category == 'tech' %}selected{% endif %}>ê¸°ìˆ </option>
            <option value="comedy" {% if category == 'comedy' %}selected{% endif %}>ì½”ë¯¸ë””</option>
            <option value="travel" {% if category == 'travel' %}selected{% endif %}>ì—¬í–‰</option>
            <option value="food" {% if category == 'food' %}selected{% endif %}>ìŒì‹</option>
            <option value="lifestyle" {% if category == 'lifestyle' %}selected{% endif %}>ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
            <option value="news" {% if category == 'news' %}selected{% endif %}>ë‰´ìŠ¤</option>
            <option value="etc" {% if category == 'etc' %}selected{% endif %}>ê¸°íƒ€</option>
          </select>
          <label class="filter-label">ì •ë ¬</label>
          <select name="sort" class="filter-select" onchange="this.form.submit()">
            <option value="latest" {% if sort == 'latest' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
            <option value="popular" {% if sort == 'popular' %}selected{% endif %}>ì¸ê¸°ìˆœ</option>
            <option value="views" {% if sort == 'views' %}selected{% endif %}>ì¡°íšŒìˆ˜ìˆœ</option>
          </select>
        </div>
      </form>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
    <div class="search-results">
      {% if videos %}
      <div class="search-results-header">
        <p class="search-results-count">
          <strong>{{ videos.total }}</strong>ê°œì˜ ê²°ê³¼
        </p>
        <p class="search-query">ê²€ìƒ‰ì–´: <strong>{{ q }}</strong></p>
      </div>

      <div class="search-results-list">
        {% for video in videos.items %}
        <div class="search-result-item" data-type="video">
          <a href="{{ url_for('main.watch', video_id=video.id) }}" class="result-thumb">
            {% if video.thumbnail_path %}
            <img src="{{ url_for('main.media_thumbnail', filename=video.thumbnail_path) }}" alt="" class="result-thumb-img">
            {% else %}
            <div class="result-thumb-placeholder">ğŸ“¹</div>
            {% endif %}
          </a>
          <div class="result-info">
            <h3 class="result-title">
              <a href="{{ url_for('main.watch', video_id=video.id) }}">{{ video.title }}</a>
            </h3>
            <div class="result-meta">
              <span class="result-views">ì¡°íšŒìˆ˜ {{ video.views }}íšŒ</span>
              <span class="result-likes">Â· ì¢‹ì•„ìš” {{ video.likes|default(0) }}</span>
              <span class="result-date">Â· {{ video.created_at.strftime('%Y-%m-%d') if video.created_at else '' }}</span>
            </div>
            <div class="result-channel">
              <a href="{{ url_for('main.user_profile', username=video.user.username if video.user else 'default') }}" class="channel-link">{{ video.user.username if video.user else 'default' }}</a>
            </div>
            <p class="result-description">
              {{ (video.description or '')[:150] }}{% if video.description and video.description|length > 150 %}...{% endif %}
            </p>
          </div>
        </div>
        {% else %}
        <p class="search-no-results">"{{ q }}"ì— ëŒ€í•œ ë™ì˜ìƒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      {% if videos.pages > 1 %}
      <nav class="pagination" aria-label="ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€">
        <div class="pagination-inner">
          {% if videos.has_prev %}
          <a href="{{ url_for('main.search', q=q, category=category, sort=sort, page=videos.prev_num) }}" class="pagination-link">ì´ì „</a>
          {% endif %}
          <span class="pagination-info">
            {{ videos.page }} / {{ videos.pages }}
          </span>
          {% if videos.has_next %}
          <a href="{{ url_for('main.search', q=q, category=category, sort=sort, page=videos.next_num) }}" class="pagination-link">ë‹¤ìŒ</a>
          {% endif %}
        </div>
      </nav>
      {% endif %}
      {% else %}
      <p class="search-no-results">"{{ q }}"ì— ëŒ€í•œ ë™ì˜ìƒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}
    </div>
    {% else %}
    <!-- ê²€ìƒ‰ì–´ ì—†ì„ ë•Œ -->
    <div class="search-empty">
      <div class="search-empty-icon">ğŸ”</div>
      <h2 class="search-empty-title">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
      <p class="search-empty-text">ìœ„ì˜ ê²€ìƒ‰ì°½ì— ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë™ì˜ìƒì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
    </div>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/search-page.js') }}"></script>
{% endblock %}
