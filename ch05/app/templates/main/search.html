{% extends "base.html" %}

{% block title %}ê²€ìƒ‰: {{ query or '' }} - WeTube{% endblock %}

{% block content %}
  <div class="search-page" data-logged-in-only>
    <!-- ê²€ìƒ‰ í•„í„° -->
    <div class="search-filters">
      <div class="filter-tabs">
        <button type="button" class="filter-tab active" data-filter="all">ì „ì²´</button>
        <button type="button" class="filter-tab" data-filter="videos">ë™ì˜ìƒ</button>
        <button type="button" class="filter-tab" data-filter="channels">ì±„ë„</button>
        <button type="button" class="filter-tab" data-filter="playlists">ì¬ìƒëª©ë¡</button>
      </div>
      <div class="search-sort">
        <button type="button" class="sort-btn" id="sort-btn">
          <span class="sort-icon">ğŸ”½</span>
          <span class="sort-text">ì •ë ¬ ê¸°ì¤€</span>
        </button>
        <div class="sort-menu" id="sort-menu" style="display: none;">
          <button type="button" class="sort-option active" data-sort="relevance">ê´€ë ¨ì„±</button>
          <button type="button" class="sort-option" data-sort="date">ì—…ë¡œë“œ ë‚ ì§œ</button>
          <button type="button" class="sort-option" data-sort="views">ì¡°íšŒìˆ˜</button>
          <button type="button" class="sort-option" data-sort="rating">í‰ì </button>
        </div>
      </div>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
    <div class="search-results">
      {% if query %}
      <div class="search-results-header">
        <p class="search-results-count">
          <strong id="results-count">{{ results_count or 0 }}</strong>ê°œì˜ ê²°ê³¼
        </p>
        <p class="search-query">ê²€ìƒ‰ì–´: <strong>{{ query }}</strong></p>
      </div>

      <!-- ë™ì˜ìƒ ê²°ê³¼ -->
      <div class="search-results-list" id="results-list" data-filter="all">
        {% for video in videos or [] %}
        <div class="search-result-item" data-type="video">
          <a href="{{ url_for('main.watch', video_id=video.id) }}" class="result-thumb">
            {% if video.thumbnail_path %}
            <img src="{{ url_for('main.media_thumbnail', filename=video.thumbnail_path) }}" alt="" class="result-thumb-img">
            {% else %}
            <div class="result-thumb-placeholder">ğŸ“¹</div>
            {% endif %}
          </a>
          <div class="result-info">
            <h3 class="result-title">
              <a href="{{ url_for('main.watch', video_id=video.id) }}">{{ video.title }}</a>
            </h3>
            <div class="result-meta">
              <span class="result-views">ì¡°íšŒìˆ˜ {{ video.views }}íšŒ</span>
              <span class="result-date">Â· {{ video.created_at.strftime('%Y-%m-%d') if video.created_at else '' }}</span>
            </div>
            <div class="result-channel">
              <a href="{{ url_for('main.user_profile', username='default') }}" class="channel-link">default</a>
            </div>
            <p class="result-description">
              {{ (video.description or '')[:150] }}{% if video.description and video.description|length > 150 %}...{% endif %}
            </p>
          </div>
        </div>
        {% else %}
        <p class="search-no-results">"{{ query }}"ì— ëŒ€í•œ ë™ì˜ìƒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
      </div>

      <!-- ì±„ë„ ê²°ê³¼ (í•„í„°: channelsì¼ ë•Œë§Œ í‘œì‹œ) -->
      <div class="search-results-list" id="results-channels" data-filter="channels" style="display: none;">
        {% for i in range(5) %}
        <div class="search-result-item search-result-item--channel" data-type="channel">
          <a href="{{ url_for('main.user_profile', username='channel' ~ (i+1)) }}" class="result-channel-avatar">
            <span>C{{ i + 1 }}</span>
          </a>
          <div class="result-info">
            <h3 class="result-title">
              <a href="{{ url_for('main.user_profile', username='channel' ~ (i+1)) }}">{{ query }} ì±„ë„ {{ i + 1 }}</a>
            </h3>
            <div class="result-meta">
              <span class="result-subs">êµ¬ë…ì {{ (i + 1) * 50 }}ëª…</span>
              <span class="result-videos">Â· ë™ì˜ìƒ {{ (i + 1) * 10 }}ê°œ</span>
            </div>
            <p class="result-description">
              "{{ query }}" ê´€ë ¨ ì±„ë„ì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œ ì „ìš© ìƒ˜í”Œ ë°ì´í„°ì…ë‹ˆë‹¤.
            </p>
            <button type="button" class="btn btn--primary btn--small" data-subscribe>êµ¬ë…</button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- ê²€ìƒ‰ì–´ ì—†ì„ ë•Œ -->
      <div class="search-empty">
        <div class="search-empty-icon">ğŸ”</div>
        <h2 class="search-empty-title">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
        <p class="search-empty-text">ìœ„ì˜ ê²€ìƒ‰ì°½ì— ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë™ì˜ìƒì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="search-logged-out" data-logged-out-only>
    <div class="hero">
      <h1>ê²€ìƒ‰í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h1>
      <p>ë™ì˜ìƒì„ ê²€ìƒ‰í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
      <a href="{{ url_for('auth.login') }}" class="btn btn--primary">ë¡œê·¸ì¸</a>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/search-page.js') }}"></script>
{% endblock %}
