{% extends "base.html" %}

{% block title %}WeTube â€“ í™ˆ{% endblock %}

{% block content %}
  <section class="home-content">
    <h2 class="section-title">ìµœì‹  ë™ì˜ìƒ</h2>

    <!-- ì¹´í…Œê³ ë¦¬Â·ì •ë ¬Â·íƒœê·¸ í•„í„° (ì„ íƒ ê°’ ìœ ì§€, active í‘œì‹œ) -->
    {% set _category = request.args.get('category') or 'all' %}
    {% set _sort = request.args.get('sort') or 'latest' %}
    {% set _tag = request.args.get('tag') or '' %}
    <div class="home-filter-bar">
      <div class="home-filter-tabs">
        <span class="filter-label">ì¹´í…Œê³ ë¦¬</span>
        <a href="{{ url_for('main.index', category='all', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'all' %}active{% endif %}">ì „ì²´</a>
        <a href="{{ url_for('main.index', category='entertainment', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'entertainment' %}active{% endif %}">ì—”í„°í…Œì¸ë¨¼íŠ¸</a>
        <a href="{{ url_for('main.index', category='music', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'music' %}active{% endif %}">ìŒì•…</a>
        <a href="{{ url_for('main.index', category='sports', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'sports' %}active{% endif %}">ìŠ¤í¬ì¸ </a>
        <a href="{{ url_for('main.index', category='game', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'game' %}active{% endif %}">ê²Œì„</a>
        <a href="{{ url_for('main.index', category='education', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'education' %}active{% endif %}">êµìœ¡</a>
        <a href="{{ url_for('main.index', category='tech', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'tech' %}active{% endif %}">ê¸°ìˆ </a>
        <a href="{{ url_for('main.index', category='comedy', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'comedy' %}active{% endif %}">ì½”ë¯¸ë””</a>
        <a href="{{ url_for('main.index', category='travel', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'travel' %}active{% endif %}">ì—¬í–‰</a>
        <a href="{{ url_for('main.index', category='food', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'food' %}active{% endif %}">ìŒì‹</a>
        <a href="{{ url_for('main.index', category='lifestyle', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'lifestyle' %}active{% endif %}">ë¼ì´í”„ìŠ¤íƒ€ì¼</a>
        <a href="{{ url_for('main.index', category='news', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'news' %}active{% endif %}">ë‰´ìŠ¤</a>
        <a href="{{ url_for('main.index', category='etc', sort=_sort, tag=_tag) }}" class="filter-tab-home {% if _category == 'etc' %}active{% endif %}">ê¸°íƒ€</a>
      </div>

      <div class="home-sort-bar">
        <span class="sort-label">ì •ë ¬</span>
        <a href="{{ url_for('main.index', category=_category, sort='latest', tag=_tag) }}" class="sort-option-home {% if _sort == 'latest' %}active{% endif %}">ìµœì‹ ìˆœ</a>
        <a href="{{ url_for('main.index', category=_category, sort='popular', tag=_tag) }}" class="sort-option-home {% if _sort == 'popular' %}active{% endif %}">ì¸ê¸°ìˆœ</a>
        <a href="{{ url_for('main.index', category=_category, sort='views', tag=_tag) }}" class="sort-option-home {% if _sort == 'views' %}active{% endif %}">ì¡°íšŒìˆ˜ìˆœ</a>
      </div>

      <div class="popular-tags-inline">
        <span class="tags-label">ì¸ê¸° íƒœê·¸</span>
        <a href="{{ url_for('main.index', category=_category, sort=_sort) }}" class="tag-pill tag-pill--small {% if not current_tag %}active{% endif %}">ì „ì²´</a>
        {% for t in popular_tags or [] %}
        <a href="{{ url_for('main.index', category=_category, sort=_sort, tag=t.name) }}" class="tag-pill tag-pill--small {% if current_tag == t.name %}active{% endif %}">#{{ t.name }}</a>
        {% endfor %}
      </div>
    </div>

    <div class="video-grid" id="video-grid" data-api-base="/api/videos" data-category="{{ _category }}" data-sort="{{ _sort }}" data-tag="{{ _tag }}">
      {% for video in videos.items %}
      <article class="video-card">
        <a href="{{ url_for('main.watch', video_id=video.id) }}" class="video-card-link">
          <div class="video-card-thumb">
            {% if video.thumbnail_path %}
            <img src="{{ url_for('main.media_thumbnail', filename=video.thumbnail_path) }}" alt="" class="video-card-thumb-img">
            {% else %}
            <span>ğŸ“¹</span>
            {% endif %}
          </div>
          <h3 class="video-card-title">{{ video.title }}</h3>
        </a>
        <a href="{{ url_for('main.user_profile', username=video.user.username if video.user else 'default') }}" class="video-card-channel">{{ video.user.username if video.user else 'default' }}</a>
        <p class="video-card-meta">ì¡°íšŒìˆ˜ {{ video.views }}íšŒ</p>
        {% if video.tags %}
        <div class="video-card-tags">
          {% for t in video.tags[:3] %}
          <a href="{{ url_for('main.tag', tag_name=t.name) }}" class="video-card-tag">#{{ t.name }}</a>
          {% endfor %}
        </div>
        {% endif %}
      </article>
      {% else %}
      <p class="home-empty">ë“±ë¡ëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤. <a href="{{ url_for('studio.upload') }}">Studio</a>ì—ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
      {% endfor %}
    </div>
    {% if videos and videos.has_next %}
    <div class="load-more-wrap" style="text-align: center; margin: 1.5rem 0;">
      <button type="button" class="btn btn--outline" id="btn-load-more" data-next-page="{{ videos.next_num }}">ë” ë³´ê¸°</button>
    </div>
    {% endif %}
  </section>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/index-page.js') }}"></script>
{% endblock %}
